"use strict";function _interopRequireDefault(r){return r&&r.__esModule?r:{"default":r}}function parse(r){var e=[],t=/^#.*/;return r.split("\n").forEach(function(r){r.match(t)||e.push(parseLine(r))}),e}function parseLine(r){for(var e={lyrics:"",chords:[],directives:[]},t=/\[([a-zA-Z0-9#\/]+)\]/g,n=/\{\s*([^:}]*)\s*:{0,1}\s*([^:]*?)\s*}/g,i=[];o=t.exec(r);)o.type="chord",i.push(o);for(;o=n.exec(r);)o.type="directive",i.push(o);i.sort(function(r,e){return r.index-e.index});var s,o,a=0,c=!0,l=!1,u=void 0;try{for(var h,f=i[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var p=h.value;if(s=r.substring(a,p.index),s&&(e.lyrics+=s),"chord"==p.type){var d=0;if(e.chords.length>0){var v=e.chords[e.chords.length-1];d=Math.max(0,v.pos+v.value.length+1-e.lyrics.length)}for(var y=0;d>y;y++)e.lyrics+=" ";var g=p[0];e.chords.push({pos:e.lyrics.length,value:g.replace(/[\[\]]/g,"")}),a=p.index+g.length}else if("directive"==p.type){var m=p[0];e.directives.push({pos:e.lyrics.length,type:getDirectiveType(p[1]),value:p[2]}),a=p.index+m.length}}}catch(x){l=!0,u=x}finally{try{!c&&f["return"]&&f["return"]()}finally{if(l)throw u}}return s=r.substring(a,r.length),s&&(e.lyrics+=s),e.lyrics=e.lyrics.replace(/\s+$/,""),e}function getDirectiveType(r){return r=r.toLowerCase(),"t"===r?"title":"st"===r?"subtitle":"c"===r?"comment":r}function formatLyricsEntry(r,e,t){function n(r,e){var n=r.replace(/(<([^>]+)>)/gi,""),i=e.pos-n.length;i>0&&(r+=Array(i+1).join(" "));var s=e.value;return t&&(s=t(s)),r+=s}var i="";if(r.chords.length>0){var s="";r.chords.forEach(function(r){s=n(s,r)}),i+=s}return(r.lyrics.length>0||0===r.chords.length)&&(i.length>0&&(i+=e),i+=r.lyrics),i}function format(r,e,t){var n=parse(r),i="";return n.forEach(function(r){i.length>0&&(i+=e),i+=formatLyricsEntry(r,e,t)}),i}function toText(r){return format(r,"\n")}function toHtml(r,e){e||(e={}),e.chordFormatter||(e.chordFormatter=function(r){return"<b>"+r+"</b>"});var t="<pre>";return e["class"]&&(t='<pre class="'+e["class"]+'">'),(0,_sanitizeHtml2["default"])(t+format(r,"<br/>",e.chordFormatter)+"</pre>",{allowedAttributes:{pre:["class"]}})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.parse=parse,exports.toText=toText,exports.toHtml=toHtml;var _sanitizeHtml=require("sanitize-html"),_sanitizeHtml2=_interopRequireDefault(_sanitizeHtml);