"use strict";function _interopRequireDefault(r){return r&&r.__esModule?r:{"default":r}}function parse(r){var e=[];return r.split("\n").forEach(function(r){var t;r.match(commentRegex)||(t=r.match(directiveRegex)?parseDirectiveLine(r):r.match(chordRegex)?parseLyricsLineWithChords(r):parseStraightLyricsLine(r)),t&&e.push(t)}),e}function parseDirectiveLine(r){var e=r.match(directiveRegex);if(3===e.length){var t=e[1].toLowerCase(),i=e[2];if("title"===t||"t"===t)return{type:"title",value:i};if("subtitle"===t||"st"===t)return{type:"subtitle",value:i};if("comment"===t||"c"===t)return{type:"comment",value:i};if(""===i)return{type:t}}}function parseLyricsLineWithChords(r){for(var e,t,i={type:"lyrics",lyrics:"",chords:[]},n=0;t=chordRegex.exec(r);){e=r.substring(n,t.index),e&&(i.lyrics+=e);var s=0;if(i.chords.length>0){var c=i.chords[i.chords.length-1];s=Math.max(0,c.pos+c.chord.length+1-i.lyrics.length)}for(var o=0;s>o;o++)i.lyrics+=" ";var a=t[0];i.chords.push({pos:i.lyrics.length,chord:a.replace(/[\[\]]/g,"")}),n=t.index+a.length}return e=r.substring(n,r.length),e&&(i.lyrics+=e),i.lyrics=i.lyrics.replace(/\s+$/,""),i}function parseStraightLyricsLine(r){return{type:"lyrics",lyrics:r,chords:[]}}function formatLyricsEntry(r,e,t){function i(r,e){var i=r.replace(/(<([^>]+)>)/gi,""),n=e.pos-i.length;n>0&&(r+=Array(n+1).join(" "));var s=e.chord;return t&&(s=t(s)),r+=s}var n="";if(r.chords.length>0){var s="";r.chords.forEach(function(r){s=i(s,r)}),n+=s}return(r.lyrics.length>0||0===r.chords.length)&&(n.length>0&&(n+=e),n+=r.lyrics),n}function format(r,e,t){var i=parse(r),n="";return i.forEach(function(r){"lyrics"===r.type&&(n.length>0&&(n+=e),n+=formatLyricsEntry(r,e,t))}),n}function toText(r){return format(r,"\n")}function toHtml(r,e){e||(e={}),e.chordFormatter||(e.chordFormatter=function(r){return"<b>"+r+"</b>"});var t="<pre>";return e["class"]&&(t='<pre class="'+e["class"]+'">'),(0,_sanitizeHtml2["default"])(t+format(r,"<br/>",e.chordFormatter)+"</pre>",{allowedAttributes:{pre:["class"]}})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.parse=parse,exports.toText=toText,exports.toHtml=toHtml;var _sanitizeHtml=require("sanitize-html"),_sanitizeHtml2=_interopRequireDefault(_sanitizeHtml),chordRegex=/\[([a-zA-Z0-9#\/]+)\]/g,directiveRegex=/\{\s*([^:]*)\s*:{0,1}\s*([^:]*?)\s*}/,commentRegex=/^#/;